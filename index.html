<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="style.css" rel="stylesheet" type="text/css" />
</head>

<script src="NodePlayer.js"></script>

<script>
  window.onload = function () {

	var domain = document.location.hostname;

	if (['jcool.live', 'hnhtalpakan.live', 'agtalpakan.live', 'sph88.live', 'wdslasher.live'].includes(domain)) {

		window.location.replace("https://www.youtube.com/embed/BjUn6pu74wc?autoplay=1");

	}

    var istab = false;
    var v_source = "wss://esportwd.live:8443/live/esportwd2.flv";

    var button = document.getElementById("play");
    var canvas = document.getElementById("video");
    var player = document.getElementById("video-player");

    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;

    var url = document.getElementById("url");
    var audioCB = document.getElementById("audioCB");


    var np = new Module.NodePlayer();
    var isStarting = false;
    var hasSound = false;

    np.on('start', () => {
      Module.print('NodePlayer on start');
    });
    np.on('close', () => {
      Module.print('NodePlayer on close');
    });
    np.on('error', (err) => {
      Module.print('NodePlayer on error',err);
    });
    np.setPlayView('video');
    np.setScaleMode(1);
    np.enableVideo(1);
    np.enableAudio(0);

    var playback = function (event) {
      if (isStarting) {
        np.stop();
        button.value = "►";
        isStarting = false;
      } else {
        np.start(v_source);
        button.value = "❚❚";
        isStarting = true;
      }
    }

    var audioChange = function (event) {
	
     	if (hasSound) {
		audioCB.value = "🔇";
		np.enableAudio(0);
		hasSound = false;
	} else {
		audioCB.value = "🔊";
		np.enableAudio(1);
		hasSound = true;
	}

    }

    if (button.addEventListener) {
      button.addEventListener("click", playback, false);
    } else if (button.attachEvent) {
      button.attachEvent('onclick', playback);
    }

    if (audioCB.addEventListener) {
      audioCB.addEventListener("click", audioChange, false);
    } else if (audioCB.attachEvent) {
      audioCB.attachEvent('onclick', audioChange);
    }


	//Initial
      	setTimeout(function(){
       		np.start(v_source);
        	button.value = "❚❚" + window.innerHeight;
        	isStarting = true;
		audioCB.value = "🔇";
      	},2000);

	document.addEventListener('visibilitychange', function (event) {
   		if (document.hidden) {

      			setTimeout(function(){
				np.stop();
        			button.value = "►";
        			isStarting = false;
				istab = false;
      			},2000);


    		} else {
      			setTimeout(function(){
       				np.start(v_source);
        			button.value = "❚❚";
        			isStarting = true;
      			},2000);
    		}
	});

	window.addEventListener('resize', function(event){
		location.reload();
	});


  };

</script>

<body>

   <div class="video-player">

   <canvas id="video"></canvas>
      <div class="player-controls">

  	<input id="play" class="play-button" type="button"/>

    	<input id="audioCB" class="play-sound" type="button"/>

      </div>

     </div>

</body>

</html>
